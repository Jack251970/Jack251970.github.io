import{d as g}from"./vendor-7fe3a1dd.js";import{n as h,L as u,p as n,s as o,h as _}from"./index-34b1b7d7.js";const f={name:"ArchiveCard",props:{cover:{type:String,default:""},title:{type:String,default:""},createdAt:{type:String,default:""}},computed:{create(){return this.createdAt.slice(5,10)}}};var m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"archive-card"},[e("figure",{staticClass:"archive-cover"},[e("img",{attrs:{src:t.cover||t.$config.defaultCover,alt:"cover"}})]),e("div",{staticClass:"archive-text"},[e("h3",[t._v(t._s(t.create))]),e("p",[t._v(t._s(t.title))])])])},p=[],C=h(f,m,p,!1,null,"e3c22454",null,null);const A=C.exports;const y={name:"Archives",components:{ArchiveCard:A,Loading:u},data(){return{totalCount:0,archives:[],archiveMap:{},tags:[],isFilter:!1,filterCount:0,timer:null,loading:!0}},computed:{editLink(){let s="https://github.com/";return s+=`${this.$config.username}/${this.$config.repository}/issues`,s},filterText(){return this.filterCount===0?"No articles under this tag for now.":`There are ${this.filterCount} articles under this tag.`}},created(){this.getArchiveCountFn(),this.getArchivesFn(),this.getTagsFn()},beforeUnmount(){clearTimeout(this.timer)},methods:{...g({getPostsCountAction:"github/getPostsCountAction",getPostsAction:"github/getPostsAction",getTagsAction:"github/getTagsAction"}),async getArchiveCountFn(){this.totalCount=await this.getPostsCountAction().catch(s=>{throw this.$message({content:"Failed to fetch article number!",type:"error"}),new Error(s)})},async getArchivesFn(){this.archives=this.archives.concat(await this.getPostsAction({page:1,pageSize:100}).catch(t=>{throw this.$message({content:"Failed to fetch article list!",type:"error"}),new Error(t)}).finally(()=>{this.loading=!1}));const s=n(this.archives);this.archiveMap=o(s)},async getTagsFn(){this.tags=await this.getTagsAction().catch(s=>{throw this.$message({content:"Failed to fetch tag list!",type:"error"}),new Error(s)}),this.tags.forEach((s,t)=>{s.index=t,s.hslColor=_(`#${s.color}}`)})},filterArchives(s){const t=s.target,e=this.tags||[];if(t.classList.contains("tag")){this.loading=!0;const a=Number(t.getAttribute("data-tag")),i=Math.random()*(1300-300)+300,l=e.find(r=>r.id===a);if(l){const r=this.archives.filter(c=>c.tags.find(d=>d.id===l.id));t.parentNode.querySelectorAll(".tag").forEach(c=>{c.classList.remove("active")}),t.classList.add("active");const v=n(r);this.archiveMap=o(v),this.filterCount=r.length,this.isFilter=!0,this.timer=setTimeout(()=>{clearTimeout(this.timer),this.loading=!1},i)}}},clearAll(){this.$refs.tagList.querySelectorAll(".tag").forEach(t=>{t.classList.remove("active")});const s=n(this.archives);this.archiveMap=o(s),this.isFilter=!1}}};var $=function(){var t=this,e=t._self._c;return e("div",{staticClass:"archives-wrap"},[e("div",{staticClass:"archives"},[e("div",{staticClass:"tags"},[e("div",{staticClass:"tags-header"},[e("h2",[e("SvgIcon",{attrs:{name:"biaoqian"}}),t._v(" Tag")],1),t.isFilter?e("div",{staticClass:"clear-all",on:{click:t.clearAll}},[t._v(" æ¸…é™¤é€‰ä¸­ ")]):t._e()]),e("div",{staticClass:"tags-body"},[e("ul",{ref:"tagList",staticClass:"tag-list",on:{click:t.filterArchives}},t._l(t.tags,function(a){return e("li",{key:a.id,staticClass:"tag",style:{"--color":`#${a.color}`,"--tag-hsl":a.hslColor,"--delay":`${a.index}`},attrs:{"data-tag":a.id}},[t._v(" "+t._s(a.name||"")+" ")])}),0)])]),e("div",{staticClass:"archives-list"},[e("div",{staticClass:"archives-header"},[t.isFilter?e("h2",[e("SvgIcon",{attrs:{name:"danju"}}),t._v(" "+t._s(t.filterText)+" ")],1):e("h2",[e("SvgIcon",{attrs:{name:"danju"}}),t._v(" You have written "+t._s(t.totalCount)+" articles already, keep up the great work! ðŸ˜Š "),e("a",{staticClass:"edit",attrs:{href:t.editLink,target:"_blank"}},[e("SvgIcon",{attrs:{name:"shuru"}})],1)],1)]),e("div",{staticClass:"archives-body"},[t.loading?e("Loading"):t._e(),e("transition",{attrs:{name:"from-bottom"}},[t.loading?t._e():e("div",t._l(Object.keys(t.archiveMap).reverse(),function(a){return e("div",{key:a,staticClass:"archive-items"},[e("div",{staticClass:"archive-year"},[t._v(" "+t._s(a)+" ")]),e("div",{staticClass:"archive-item-list"},t._l(t.archiveMap[a],function(i){return e("router-link",{key:i.id,attrs:{to:{name:"Post",params:{number:i.number}}}},[e("ArchiveCard",{attrs:{cover:i.cover,title:i.title,"created-at":i.created_at}})],1)}),1)])}),0)])],1)])])])},b=[],F=h(y,$,b,!1,null,"0a77e057",null,null);const w=F.exports;export{w as default};
